---
description: The Anatomy of a PE
---

# PE-Structure

The following diagram can be described such as:

<figure><img src="../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

## \_IMAGE\_DOS\_HEADER:

The first header, called _IMAGE\_DOS\_HEADER_ marks the file as a PE by attributing the 0x5A4D("MZ") element.

## \_DOS\_Stub:

The second header, called DOS\_Stub tells the system "Hey I am not compatible with older versions e.g. MS-DOS".

## \_IMAGE\_NT\_HEADER:

The third header, called _IMAGE\_NT\_HEADER_ is composed out of the _IMAGE\_FILE\_HEADER_, _IMAGE\_OPTIONAL\_HEADER_, _IMAGE\_DIRECTORY\_ENTRY._

Primarily the NT\_HEADER will start with the signature "PE" - 0x4550.

The FILE\_HEADER will contain the primary information of the PE, such as for what CPU Architecture is has been built, when it has been compiled and how many sections does it have.

In the OPTIONAL\_Header we will have the OEP - AddressOfEntryPoint, where in the memory it prefers to be loaded - ImageBase.

The DIRECTORY\_ENTRY tells the loader where to find the import table, export table, resources, etc...

## \_IMAGE\_SECTION\_HEADER:

The _IMAGE\_SECTION\_HEADER\[]_ is an array which describes each section from the right hand side of the diagram:

* .text (Code): This is where the machine language code (instructions) that the CPU executes resides.&#x20;
* .data, .rdata, .bss (Data):
  * .data: Mutable data, such as global variables. (Read-Write)
  * .rdata: Immutable data, such as constant strings. (Read-Only)
  * .bss: Unititalized variables.
  * .idata (Import API): This section contains the Import Address Table (IAT). It's a list of all the functions that the program will borrow from other DLLs or libraries. E.g. CreateFile from kernel32.dll.
  * .edata (Export API): If the file is a DLL, here is the list of the functions that it provides to other programs.
  * .rsrc (Resource): Here are stored the non-executables: icons, images, menus, audios, etc...
  * .reloc (Relocation Info): Contains info to "repair" the code in memory if the file can't be loaded at the preferred memory space (ImageBase).
